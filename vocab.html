<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vocabulary Harian - English Learning SMP</title>
  <link rel="stylesheet" href="style.css">
  <script src="audio/tone-generator.js"></script>
  <script src="auth.js"></script>
  <script src="header.js"></script>
  <script src="data.js"></script>
  <style>
    .vocab-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .vocab-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .search-filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 25px;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .search-box {
      flex: 1;
      min-width: 200px;
    }
    
    .search-box input {
      width: 100%;
      padding: 12px 20px;
      border: 2px solid #ddd;
      border-radius: 25px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    .search-box input:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .filter-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .filter-select {
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }
    
    .mode-buttons {
      display: flex;
      gap: 10px;
    }
    
    .mode-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    
    .mode-btn.active {
      background: #3498db;
      color: white;
      transform: translateY(-2px);
    }
    
    .mode-btn:not(.active) {
      background: #ecf0f1;
      color: #2c3e50;
    }
    
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .vocab-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .vocab-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3498db, #2ecc71);
    }
    
    .vocab-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }
    
    .vocab-word {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }
    
    .vocab-pronunciation {
      font-size: 14px;
      color: #7f8c8d;
      font-style: italic;
      margin-bottom: 10px;
    }
    
    .vocab-meaning {
      font-size: 18px;
      color: #27ae60;
      margin-bottom: 15px;
      font-weight: 600;
    }
    
    .vocab-icon {
      font-size: 60px;
      text-align: center;
      margin: 15px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      border: 2px dashed #dee2e6;
    }
    
    .vocab-example {
      font-style: italic;
      color: #34495e;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #3498db;
    }
    
    .vocab-category {
      display: inline-block;
      background: #e74c3c;
      color: white;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .vocab-level {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 5px;
    }
    
    .level-beginner {
      background: #2ecc71;
      color: white;
    }
    
    .level-intermediate {
      background: #f39c12;
      color: white;
    }
    
    .level-advanced {
      background: #e74c3c;
      color: white;
    }
    
    .vocab-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .action-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .audio-btn {
      background: #3498db;
      color: white;
    }
    
    .audio-btn:hover {
      background: #2980b9;
    }
    
    .favorite-btn {
      background: #ecf0f1;
      color: #2c3e50;
    }
    
    .favorite-btn.favorited {
      background: #e74c3c;
      color: white;
    }
    
    .quiz-btn {
      background: #f39c12;
      color: white;
    }
    
    .quiz-btn:hover {
      background: #d68910;
    }
    
    .flashcard-mode .vocab-card {
      height: 200px;
      cursor: pointer;
      perspective: 1000px;
    }
    
    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .flashcard-mode .vocab-card.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }
    
    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .flashcard-back {
      transform: rotateY(180deg);
      background: #f8f9fa;
    }
    
    .stats-bar {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-item {
      flex: 1;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: #3498db;
    }
    
    .stat-label {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .no-results {
      text-align: center;
      padding: 50px;
      color: #7f8c8d;
    }
    
    @media (max-width: 768px) {
      .search-filter-bar {
        flex-direction: column;
      }
      
      .vocab-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <!-- Header will be populated by header.js -->
  </header>

  <div class="vocab-container">
    <div class="vocab-header">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <a href="dashboard.html" style="background: #3498db; color: white; padding: 10px 20px; border-radius: 25px; text-decoration: none; font-weight: bold; transition: all 0.3s;">‚Üê Dashboard</a>
        <h2 style="margin: 0;">Belajar Kosakata Bahasa Inggris</h2>
        <div></div>
      </div>
      <p>Tingkatkan kosakata bahasa Inggris Anda dengan cara yang menyenangkan!</p>
    </div>
    
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-number" id="totalWords">0</div>
        <div class="stat-label">Total Kata</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="learnedWords">0</div>
        <div class="stat-label">Dipelajari</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="favoritedWords">0</div>
        <div class="stat-label">Favorit</div>
      </div>
    </div>
    
    <div class="search-filter-bar">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="üîç Cari kata dalam bahasa Inggris atau Indonesia...">
      </div>
      
      <div class="filter-group">
        <select id="categoryFilter" class="filter-select">
          <option value="">Semua Kategori</option>
          <option value="Family">Keluarga</option>
          <option value="Food">Makanan</option>
          <option value="School">Sekolah</option>
          <option value="Animals">Hewan</option>
          <option value="Colors">Warna</option>
          <option value="Home">Rumah</option>
        </select>
        
        <select id="levelFilter" class="filter-select">
          <option value="">Semua Level</option>
          <option value="beginner">Pemula</option>
          <option value="intermediate">Menengah</option>
          <option value="advanced">Lanjutan</option>
        </select>
      </div>
      
      <div class="mode-buttons">
        <button class="mode-btn active" data-mode="grid">üìã Grid</button>
        <button class="mode-btn" data-mode="flashcard">üé¥ Flashcard</button>
        <button class="mode-btn" data-mode="random">üé≤ Acak</button>
      </div>
    </div>
    
    <div id="vocabArea" class="vocab-grid"></div>
  </div>

  <script>
    class VocabularyApp {
      constructor() {
        this.currentMode = 'grid';
        this.filteredWords = [...vocabData];
        this.favorites = JSON.parse(localStorage.getItem('vocabFavorites') || '[]');
        this.learned = JSON.parse(localStorage.getItem('vocabLearned') || '[]');
        this.init();
      }
      
      init() {
        this.setupEventListeners();
        this.updateStats();
        this.renderWords();
      }
      
      setupEventListeners() {
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
          this.filterWords();
        });
        
        // Filter functionality
        document.getElementById('categoryFilter').addEventListener('change', () => {
          this.filterWords();
        });
        
        document.getElementById('levelFilter').addEventListener('change', () => {
          this.filterWords();
        });
        
        // Mode switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentMode = e.target.dataset.mode;
            this.renderWords();
          });
        });
      }
      
      filterWords() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const categoryFilter = document.getElementById('categoryFilter').value;
        const levelFilter = document.getElementById('levelFilter').value;
        
        this.filteredWords = vocabData.filter(word => {
          const matchesSearch = word.word.toLowerCase().includes(searchTerm) || 
                               word.meaning.toLowerCase().includes(searchTerm);
          const matchesCategory = !categoryFilter || word.category === categoryFilter;
          const matchesLevel = !levelFilter || word.level === levelFilter;
          
          return matchesSearch && matchesCategory && matchesLevel;
        });
        
        this.renderWords();
      }
      
      renderWords() {
        const container = document.getElementById('vocabArea');
        container.className = this.currentMode === 'flashcard' ? 'vocab-grid flashcard-mode' : 'vocab-grid';
        
        if (this.filteredWords.length === 0) {
          container.innerHTML = '<div class="no-results"><h3>Tidak ada kata yang ditemukan</h3><p>Coba ubah filter atau kata kunci pencarian</p></div>';
          return;
        }
        
        let wordsToShow = [...this.filteredWords];
        if (this.currentMode === 'random') {
          wordsToShow = [this.filteredWords[Math.floor(Math.random() * this.filteredWords.length)]];
        }
        
        container.innerHTML = wordsToShow.map(word => this.createWordCard(word)).join('');
      }
      
      createWordCard(word) {
        const isLearned = this.learned.includes(word.word);
        const isFavorited = this.favorites.includes(word.word);
        const wordIcon = this.getWordIcon(word.word, word.category);
        
        if (this.currentMode === 'flashcard') {
          return `
            <div class="vocab-card" onclick="this.classList.toggle('flipped')">
              <div class="flashcard-inner">
                <div class="flashcard-front">
                  <div class="vocab-icon">${wordIcon}</div>
                  <div class="vocab-word">${word.word}</div>
                  <div class="vocab-pronunciation">${word.pronunciation}</div>
                  <div style="margin-top: 20px; color: #7f8c8d;">Klik untuk melihat arti</div>
                </div>
                <div class="flashcard-back">
                  <div class="vocab-meaning">${word.meaning}</div>
                  <div class="vocab-example">"${word.example}"</div>
                  <div>
                    <span class="vocab-category">${word.category}</span>
                    <span class="vocab-level level-${word.level}">${word.level}</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        
        return `
          <div class="vocab-card">
            <span class="vocab-category">${word.category}</span>
            <span class="vocab-level level-${word.level}">${word.level}</span>
            
            <div class="vocab-word">${word.word}</div>
            <div class="vocab-pronunciation">${word.pronunciation}</div>
            <div class="vocab-meaning">${word.meaning}</div>
            
            <div class="vocab-icon">${wordIcon}</div>
            
            <div class="vocab-example">"${word.example}"</div>
            
            <div class="vocab-actions">
              <button class="action-btn audio-btn" onclick="app.playAudio('${word.word}')">
                üîä Dengar
              </button>
              <button class="action-btn favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="app.toggleFavorite('${word.word}')">
                ${isFavorited ? '‚ù§Ô∏è' : 'ü§ç'} Favorit
              </button>
              <button class="action-btn quiz-btn" onclick="app.quickQuiz('${word.word}')">
                üß† Quiz
              </button>
            </div>
          </div>
        `;
      }
      
      getWordIcon(word, category) {
        // Icon mapping berdasarkan kata dan kategori
        const iconMap = {
          // Family
          'mother': 'üë©',
          'father': 'üë®',
          'sister': 'üëß',
          'brother': 'üë¶',
          'grandmother': 'üëµ',
          'grandfather': 'üë¥',
          'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
          'parent': 'üë´',
          'baby': 'üë∂',
          
          // Food
          'apple': 'üçé',
          'banana': 'üçå',
          'orange': 'üçä',
          'rice': 'üçö',
          'bread': 'üçû',
          'water': 'üíß',
          'milk': 'ü•õ',
          'egg': 'ü•ö',
          'fish': 'üêü',
          'meat': 'ü•©',
          'vegetables': 'ü•¨',
          'fruit': 'üçá',
          'food': 'üçΩÔ∏è',
          
          // School
          'school': 'üè´',
          'teacher': 'üë©‚Äçüè´',
          'student': 'üë®‚Äçüéì',
          'book': 'üìö',
          'pencil': '‚úèÔ∏è',
          'desk': 'ü™ë',
          'classroom': 'üèõÔ∏è',
          'homework': 'üìù',
          'test': 'üìÑ',
          'lesson': 'üìñ',
          
          // Animals
          'cat': 'üê±',
          'dog': 'üê∂',
          'bird': 'üê¶',
          'fish': 'üê†',
          'elephant': 'üêò',
          'lion': 'ü¶Å',
          'rabbit': 'üê∞',
          'tiger': 'üêÖ',
          'bear': 'üêª',
          'horse': 'üê¥',
          
          // Colors
          'red': 'üî¥',
          'blue': 'üîµ',
          'green': 'üü¢',
          'yellow': 'üü°',
          'black': '‚ö´',
          'white': '‚ö™',
          'purple': 'üü£',
          'orange': 'üü†',
          'pink': 'ü©∑',
          'brown': 'ü§é',
          
          // Home
          'house': 'üè†',
          'room': 'üè†',
          'kitchen': 'üç≥',
          'bedroom': 'üõèÔ∏è',
          'bathroom': 'üöø',
          'living room': 'üõãÔ∏è',
          'garden': 'üåª',
          'door': 'üö™',
          'window': 'ü™ü',
          'table': 'ü™ë'
        };
        
        // Cari icon spesifik untuk kata
        const specificIcon = iconMap[word.toLowerCase()];
        if (specificIcon) return specificIcon;
        
        // Fallback berdasarkan kategori
        const categoryIcons = {
          'Family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
          'Food': 'üçé',
          'School': 'üìö',
          'Animals': 'üê±',
          'Colors': 'üé®',
          'Home': 'üè†'
        };
        
        return categoryIcons[category] || 'üìù';
      }
      
      playAudio(word) {
        // Primary: Try to play physical audio file
        const audio = new Audio();
        const audioFile = `./audio/${word.toLowerCase().replace(/\s+/g, '_')}.mp3`;
        
        audio.src = audioFile;
        audio.onerror = () => {
          // Fallback 1: Try alternative audio sources
          const altSources = [
            `https://ssl.gstatic.com/dictionary/static/sounds/oxford/${word.toLowerCase()}_1_gb_1.mp3`,
            `https://ssl.gstatic.com/dictionary/static/sounds/oxford/${word.toLowerCase()}_1_us_1.mp3`
          ];
          
          let sourceIndex = 0;
          
          const tryNextSource = () => {
            if (sourceIndex < altSources.length) {
              audio.src = altSources[sourceIndex];
              sourceIndex++;
            } else {
              // Fallback 2: Use Speech Synthesis with better error handling
              this.fallbackTextToSpeech(word);
            }
          };
          
          audio.onerror = tryNextSource;
          tryNextSource();
        };
        
        audio.play().catch(error => {
          console.log('Audio play failed:', error);
          this.fallbackTextToSpeech(word);
        });
        
        // Mark as learned and add score
        if (!this.learned.includes(word)) {
          this.learned.push(word);
          localStorage.setItem('vocabLearned', JSON.stringify(this.learned));
          this.updateStats();
          
          // Add score to user profile
          if (typeof addVocabularyScore === 'function') {
            addVocabularyScore(5, 1);
          } else if (typeof tambahSkor === 'function') {
            tambahSkor(5, 0, 1);
          }
        }
      }
      
      fallbackTextToSpeech(word) {
        if ('speechSynthesis' in window) {
          // Cancel any ongoing speech
          speechSynthesis.cancel();
          
          // Create new utterance
          const utterance = new SpeechSynthesisUtterance(word);
          utterance.lang = 'en-US';
          utterance.rate = 0.7;
          utterance.pitch = 1;
          utterance.volume = 1;
          
          // Get available voices and prefer English ones
          const voices = speechSynthesis.getVoices();
          const englishVoice = voices.find(voice => 
            voice.lang.includes('en-') && voice.name.includes('Google')
          ) || voices.find(voice => voice.lang.includes('en-'));
          
          if (englishVoice) {
            utterance.voice = englishVoice;
          }
          
          utterance.onerror = (event) => {
            console.error('Speech synthesis error:', event);
            this.finalFallbackAudio(word);
          };
          
          try {
            speechSynthesis.speak(utterance);
          } catch (error) {
            console.error('Speech synthesis failed:', error);
            this.finalFallbackAudio(word);
          }
        } else {
          this.finalFallbackAudio(word);
        }
      }
      
      finalFallbackAudio(word) {
        // Use tone generator as final fallback
        if (typeof generateToneAudio === 'function') {
          generateToneAudio(word).then(() => {
            this.showAudioInfo('üéµ Audio placeholder dimainkan untuk: ' + word);
          }).catch(() => {
            this.showAudioError();
          });
        } else {
          this.showAudioError();
        }
      }
      
      showAudioInfo(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #3498db;
          color: white;
          padding: 15px 20px;
          border-radius: 10px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.3);
          z-index: 10000;
          font-family: Arial, sans-serif;
          animation: slideIn 0.5s ease-out;
        `;
        
        notification.innerHTML = `<div style="font-weight: bold;">${message}</div>`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 2000);
      }
      
      showAudioError() {
        // Show user-friendly error message
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #e74c3c;
          color: white;
          padding: 15px 20px;
          border-radius: 10px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.3);
          z-index: 10000;
          font-family: Arial, sans-serif;
          animation: slideIn 0.5s ease-out;
        `;
        
        notification.innerHTML = `
          <div style="font-weight: bold;">üîá Audio tidak tersedia</div>
          <div style="font-size: 12px; margin-top: 5px;">Coba refresh halaman atau gunakan browser lain</div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
      
      toggleFavorite(word) {
        if (this.favorites.includes(word)) {
          this.favorites = this.favorites.filter(w => w !== word);
        } else {
          this.favorites.push(word);
        }
        localStorage.setItem('vocabFavorites', JSON.stringify(this.favorites));
        this.updateStats();
        this.renderWords();
      }
      
      quickQuiz(word) {
        const wordData = vocabData.find(w => w.word === word);
        const otherWords = vocabData.filter(w => w.word !== word && w.category === wordData.category);
        const options = [wordData.meaning];
        
        // Add 2 random wrong answers
        while (options.length < 3 && otherWords.length > 0) {
          const randomWord = otherWords[Math.floor(Math.random() * otherWords.length)];
          if (!options.includes(randomWord.meaning)) {
            options.push(randomWord.meaning);
          }
          otherWords.splice(otherWords.indexOf(randomWord), 1);
        }
        
        // Shuffle options
        options.sort(() => Math.random() - 0.5);
        
        const answer = prompt(`Apa arti dari "${word}"?\n\n1. ${options[0]}\n2. ${options[1]}\n3. ${options[2]}\n\nKetik 1, 2, atau 3:`);
        
        if (answer) {
          const selectedAnswer = options[parseInt(answer) - 1];
          if (selectedAnswer === wordData.meaning) {
            alert('üéâ Benar! Hebat!');
            
            // Add score and mark as learned
            if (typeof addVocabularyScore === 'function') {
              addVocabularyScore(10, 1);
            } else if (typeof tambahSkor === 'function') {
              tambahSkor(10, 0, 1);
            }
            
            if (!this.learned.includes(word)) {
              this.learned.push(word);
              localStorage.setItem('vocabLearned', JSON.stringify(this.learned));
              this.updateStats();
            }
          } else {
            alert(`‚ùå Salah. Jawaban yang benar adalah: ${wordData.meaning}`);
          }
        }
      }
      
      updateStats() {
        document.getElementById('totalWords').textContent = vocabData.length;
        document.getElementById('learnedWords').textContent = this.learned.length;
        document.getElementById('favoritedWords').textContent = this.favorites.length;
      }
    }
    
    // Initialize the app
    const app = new VocabularyApp();
  </script>
  <script src="script.js"></script>
</body>
</html>
